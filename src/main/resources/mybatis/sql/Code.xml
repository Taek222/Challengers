<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.ord//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.challengers.mvc.repository.CodeRepository">

    <!-- 그룹코드 목록 조회 -->
    <select id="getGroupCodeList" resultType="kr.co.challengers.mvc.domain.Code">
        SELECT COM_GRP_CD, CD_NM
        FROM tb_comn_cd
        WHERE 1 = 1
        AND COM_CD = 'ZZ'
        AND DEL_YN = 'N'
        ORDER BY COM_GRP_CD
    </select>

    <!-- 공통코드 목록 조회 -->
    <select id="getCodeList" parameterType="kr.co.challengers.mvc.domain.Code" resultType="kr.co.challengers.mvc.domain.Code">
        SELECT COM_CD, CD_NM, USE_YN
        FROM tb_comn_cd
        WHERE 1 = 1
        AND COM_GRP_CD = #{comGrpCd}
        AND DEL_YN = 'N'
        ORDER BY SORT
    </select>

    <!-- 공통코드 사용여부 변경 -->
    <update id="updateCodeUseYn" parameterType="kr.co.challengers.mvc.domain.Code">
        UPDATE tb_comn_cd
        SET USE_YN = #{useYn}
        , MOD_USER = #{modUser}
        , MOD_DT = CURRENT_TIMESTAMP
        WHERE COM_GRP_CD = #{comGrpCd}
        AND COM_CD = #{comCd}
    </update>

    <!-- 공통코드 삭제 -->
    <delete id="deleteCode" parameterType="kr.co.challengers.mvc.domain.Code">
        UPDATE tb_comn_cd
        SET DEL_YN = 'Y'
        , MOD_USER = #{modUser}
        , MOD_DT = CURRENT_TIMESTAMP
        WHERE COM_GRP_CD = #{comGrpCd}
        <if test="comCd != null and comCd != ''">
            AND COM_CD = #{comCd}
        </if>
    </delete>

    <!-- 공통코드 등록 -->
    <insert id="insertCode" parameterType="kr.co.challengers.mvc.domain.Code">
        INSERT
        INTO tb_comn_cd
        (COM_GRP_CD,
        COM_CD,
        CD_NM,
        CD_DESC,
        DEFAULT_YN,
        SORT,
        USE_YN,
        DEL_YN,
        CRE_DT,
        REG_USER,
        MOD_DT,
        MOD_USER)
        VALUES (
        #{comGrpCd},
        #{comCd},
        #{cdNm},
        #{cdDesc},
        #{defaultYn},
        (SELECT T.NEXT_SORT FROM (SELECT MAX(SORT) + 1 AS NEXT_SORT FROM tb_comn_cd WHERE COM_GRP_CD = #{comGrpCd}) T),
        'Y',
        'N',
        CURRENT_TIMESTAMP,
        #{regUser},
        CURRENT_TIMESTAMP,
        #{modUser}
        )
    </insert>
</mapper>